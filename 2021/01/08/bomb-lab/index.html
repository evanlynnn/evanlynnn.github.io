<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CSAPP实验：Bomb Lab, EvanLynn 博客 blog">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="一、前期准备
阅读 README-bomblab.txt 文档
阅读bomblab.pdf
解压文件: linux-x86-64 binary bomb.tar由于原文件名有空格，无法使用tar -xvf命令，需对其改名先将文件名改为bom">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CSAPP实验：Bomb Lab | Evan Lynn&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Evan Lynn's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Evan Lynn's Blog</div>
        <div class="logo-desc">
            
            Algorithm | ML
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/evanlynnn/myBlog" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/evanlynnn/myBlog" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        CSAPP实验：Bomb Lab
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/组成原理/" target="_blank">
                            <span class="chip bg-color">组成原理</span>
                        </a>
                        
                        <a href="/tags/CSAPP/" target="_blank">
                            <span class="chip bg-color">CSAPP</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/CS实验/" class="post-category" target="_blank">
                            CS实验
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-01-08
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    Evan Lynn
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    32 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="一、前期准备"><a href="#一、前期准备" class="headerlink" title="一、前期准备"></a>一、前期准备</h2><ol>
<li>阅读 README-bomblab.txt 文档</li>
<li>阅读bomblab.pdf</li>
<li>解压文件: linux-x86-64 binary bomb.tar<br>由于原文件名有空格，无法使用tar -xvf命令，需对其改名<br>先将文件名改为bomb64.tar，然后在终端输入一下命令：<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> -xvf bomb64.tar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
解压完成后会在当前目录生成名为bomb的子目录</li>
<li>阅读bomb目录文件<br>在bomb目录下共有三个文件：<br>README<br>bomb.c  bomb的部分代码<br>bomb    bomb的可执行文件</li>
</ol>
<hr>
<p>打开README，发现其中的内容为：This is an x86-64 bomb for self-study students.<br>这是炸弹的学生信息<br>打开bomb.c，寻找main函数的关键信息</p>
<pre class="line-numbers language-C"><code class="language-C">printf("Welcome to my fiendish little bomb. You have 6 phases with\n");
printf("which to blow yourself up. Have a nice day!\n");

input = read_line();             /* Get input                   */
phase_1(input);                  /* Run the phase               */
phase_defused();                 /* Drat!  They figured it out!
* Let me know how they did it. */
printf("Phase 1 defused. How about the next one?\n");
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过代码，我们发现要拆解炸弹，就是给出每个阶段对应的一串输入。代码中不包含各阶段的处理函数，那么接下来就需要对bomb进行反汇编。</p>
<ol start="5">
<li>使用objdump对bomb反汇编<br>(1) 打印bomb的各函数和全局变量，并存储在bombTable.txt中<pre class="line-numbers language-bash"><code class="language-bash">objdump -t bomb<span class="token operator">></span>bombTable.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ol>
<p>(2) 对bomb反汇编，生成汇编代码，并保存在bomb.asm</p>
<pre class="line-numbers language-bash"><code class="language-bash">objdump -d bomb<span class="token operator">></span>bomb.asm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>前期准备完成，接下来开始分析汇编代码。</p>
<h2 id="二、phase-1"><a href="#二、phase-1" class="headerlink" title="二、phase_1"></a>二、phase_1</h2><h3 id="汇编代码及分析"><a href="#汇编代码及分析" class="headerlink" title="汇编代码及分析"></a>汇编代码及分析</h3><pre class="line-numbers language-assembly"><code class="language-assembly">0000000000400ee0 <phase_1>:
  400ee0:    48 83 ec 08              sub    $0x8,%rsp # 分配栈帧空间
  400ee4:    be 00 24 40 00           mov    $0x402400,%esi # 将0x402400保存在寄存器esi中
  400ee9:    e8 4a 04 00 00           callq  401338 <strings_not_equal> # 调用函数<strings_not_equal>
  400eee:    85 c0                    test   %eax,%eax # 比较函数的返回值
  400ef0:    74 05                    je     400ef7 <phase_1+0x17> # 如果返回值为0，跳到指令400ef7
  400ef2:    e8 43 05 00 00           callq  40143a <explode_bomb> # 引爆炸弹
  400ef7:    48 83 c4 08              add    $0x8,%rsp # 回收栈帧空间
  400efb:    c3                       retq   # 函数返回<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这一阶段的函数参数为一个字符串，存储在寄存器%edi中。<br>然后，将0x402400存入寄存器%esi中，<br>再调用 <strong>strings_not_equal</strong> 函数比较寄存器%edi和%esi中的两个字符串。</p>
<h3 id="查看地址0x402400的内容"><a href="#查看地址0x402400的内容" class="headerlink" title="查看地址0x402400的内容"></a>查看地址0x402400的内容</h3><p>现在我们看看向寄存器%esi存入的是什么内容：<br>使用gdb运行bomb</p>
<pre class="line-numbers language-bash"><code class="language-bash">gdb bomb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic1.png" alt="运行gdb"></p>
<p>在函数phase_1 和 explode_bomb 处 设置断点</p>
<pre class="line-numbers language-bash"><code class="language-bash">b phase_1
b explode_bomb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="pic2.png" alt="设置断点"></p>
<p>运行程序: </p>
<pre class="line-numbers language-bash"><code class="language-bash">r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic3.png" alt="运行bomb"></p>
<p>下面随便输入一串字符”aaa”，然后运行到断点<br><img src="pic4.png" alt="执行到断点"></p>
<p>我们来看看内存0x402400的内容,因为这是一个字符串，我们使用x/s命令：</p>
<pre class="line-numbers language-bash"><code class="language-bash">x/s 0x402400<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic5.png" alt="0x402400内容"><br>我们看到字符串为： </p>
<blockquote>
<p>Border relations with Canada have never been better.</p>
</blockquote>
<p>这就是阶段1的答案。<br>下面我们验证一下：<br>使用指令q退出gdb调试，然后重新运行gdb。<br>以防万一，我们先在explode_bomb设置断点，然后运行bomb。<br>输入字符串 Border relations with Canada have never been better. 第一阶段完成~<br><img src="pic6.png" alt="第一阶段"></p>
<blockquote>
<p>为了后续调试不需要手动输入之前的解码，我们把answer保存在answer.txt文件下，之后运行只需要输入r &lt; answer.txt即可。</p>
</blockquote>
<h2 id="三、phase-2"><a href="#三、phase-2" class="headerlink" title="三、phase_2"></a>三、phase_2</h2><h3 id="分析代码"><a href="#分析代码" class="headerlink" title="分析代码"></a>分析代码</h3><h4 id="片段一：循环之前"><a href="#片段一：循环之前" class="headerlink" title="片段一：循环之前"></a>片段一：循环之前</h4><p>首先看前五个指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  400efc:    55                       push   %rbp # 将寄存器%rbp压栈
  400efd:    53                       push   %rbx # 将寄存器%rbx压栈
  400efe:    48 83 ec 28              sub    $0x28,%rsp # 分配栈帧空间，大小为40字节
  400f02:    48 89 e6                 mov    %rsp,%rsi  # 将栈指针%rsp的值
  400f05:    e8 52 05 00 00           callq  40145c <read_six_numbers> # 调用函数，读取六个数字<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>阅读代码可以发现，这次要输入的为6个数。我们继续往下分析</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  400f0a:    83 3c 24 01              cmpl   $0x1,(%rsp) # 将Mem[%rsp]和1比较
  400f0e:    74 20                    je     400f30 <phase_2+0x34> # 如果这个数等于1，跳转到400f30
  400f10:    e8 25 05 00 00           callq  40143a <explode_bomb> # 引爆炸弹
  400f15:    eb 19                    jmp    400f30 <phase_2+0x34> # 跳转到400f30<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>第一条指令将Mem[%rsp]的值与1进行比较。Mem[%rsp]存储的是什么呢？我们看最开始的5条指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  400efc:    55                       push   %rbp # 将寄存器%rbp压栈
  400efd:    53                       push   %rbx # 将寄存器%rbx压栈
  400efe:    48 83 ec 28              sub    $0x28,%rsp # 分配栈帧空间，大小为40字节
  400f02:    48 89 e6                 mov    %rsp,%rsi  # 将栈指针%rsp的值
  400f05:    e8 52 05 00 00           callq  40145c <read_six_numbers> # 调用函数，读取六个数字<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先传入函数<strong>phase_2</strong>的只有1个参数——字符串，它存放在寄存器%rdi中（这是字符串第一个元素的地址）。<br>然后又将%rsp的值存储到%rsi中，然后调用函数<strong>read_six_numbers</strong>。<br>因此字符串%rdi作为<strong>read_six_numbers</strong>的第一个参数，%rsp作为该函数的第二个参数。<br>这里我猜想执行完函数后，Mem[%rsp]存储了我们输入的第一个数，<br>后面的数依次存放在Mem[%rsp + 0x4], Mem[%rsp + 0x8], Mem[%rsp + 0xc], Mem[%rsp + 0x10], Mem[%rsp + 0x14]。<br>我们用gdb来验证猜想：<br>首先在answer.txt中添加输入：“2 3 4 5 6 7”，然后调试程序。<br><strong>注意：这次断点需要打在指定的指令上，如果只在<em>explode_bomb</em>函数打断点，仍然会执行callq指令，该指令会把调用函数后需要返回的地址（下一条执行指令的地址）压栈。这样使用x/d $rsp就不会得到想要的结果</strong></p>
<h5 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h5><pre class="line-numbers language-bash"><code class="language-bash">b explode_bomb
b *0x400f0a
r <span class="token operator">&lt;</span> answer.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="pic7.png" alt="设置断点"></p>
<h5 id="查看栈帧Mem-rsp-中连续6个空间-4Bytes-6-的内容"><a href="#查看栈帧Mem-rsp-中连续6个空间-4Bytes-6-的内容" class="headerlink" title="查看栈帧Mem[%rsp]中连续6个空间(4Bytes * 6)的内容"></a>查看栈帧Mem[%rsp]中连续6个空间(4Bytes * 6)的内容</h5><pre class="line-numbers language-bash"><code class="language-bash">x/6dw <span class="token variable">$rsp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic8.png" alt="查看栈帧"></p>
<p>内容分别为2 3 4 5 6，与我们的输入顺序一致，猜想正确。<br>而根据指令，我们可以发现：第一个数必须为1。<br>我们继续往下看。</p>
<p>执行完判断后，指令跳转到400f30。我们来看看400f30这个片段代码：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  # .400f30
  400f30:    48 8d 5c 24 04           lea    0x4(%rsp),%rbx # 将%rsp+4存储到%rbx中
  400f35:    48 8d 6c 24 18           lea    0x18(%rsp),%rbp # 将%rsp+24存储到%rbp中
  400f3a:    eb db                    jmp    400f17 <phase_2+0x1b> # 跳转到400f17<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>栈帧中这个数组每个元素的大小为4 bytes。将%rsp+4存储到%rbx中，相当于将下一个元素的地址保存到%rbx中。%rbp存储数组最后一个元素的下一个地址。<br>之后指令跳转到400f17，我们来看看这段指令。</p>
<h4 id="片段二：循环"><a href="#片段二：循环" class="headerlink" title="片段二：循环"></a>片段二：循环</h4><p>先来看看机器指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  # .400f17
  400f17:    8b 43 fc                 mov    -0x4(%rbx),%eax # 将Mem[%rbx-4]存储到%eax
  400f1a:    01 c0                    add    %eax,%eax # %eax += %eax 
  400f1c:    39 03                    cmp    %eax,(%rbx) # 比较%eax和Mem[%rsp]
  400f1e:    74 05                    je     400f25 <phase_2+0x29> # 如果相等，跳过引爆炸弹
  400f20:    e8 15 05 00 00           callq  40143a <explode_bomb> # 引爆炸弹
  400f25:    48 83 c3 04              add    $0x4,%rbx # %rbx += 4
  400f29:    48 39 eb                 cmp    %rbp,%rbx # 比较%rbp 和 %rbx
  400f2c:    75 e9                    jne    400f17 <phase_2+0x1b> # 如果不相等，跳转到400f17
  400f2e:    eb 0c                    jmp    400f3c <phase_2+0x40> # 跳转到400f3c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将其转换为C语言代码</p>
<pre class="line-numbers language-C"><code class="language-C">void phase_2(int nums[6]) {
    if(nums[0] != 1)
        explode();
    int *end = nums + 6;
    int *p = nums + 1;
    while (p != end) {
        int temp = *(p - 1);
        temp += temp;
        if(*p != temp)
            explode();

        p++;
    }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到，数组中的每个元素都应该是前一个元素的两倍。由于第一个元素为1，所以这六个元素确定了：</p>
<h3 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h3><blockquote>
<p>1 2 4 8 16 32</p>
</blockquote>
<p>第二阶段完成。<br><img src="pic9.png" alt="第二阶段"></p>
<h2 id="四、phase-3"><a href="#四、phase-3" class="headerlink" title="四、phase_3"></a>四、phase_3</h2><p>首先我们来分析机器指令</p>
<h3 id="分析指令"><a href="#分析指令" class="headerlink" title="分析指令"></a>分析指令</h3><h4 id="第一块：分配栈帧空间"><a href="#第一块：分配栈帧空间" class="headerlink" title="第一块：分配栈帧空间"></a>第一块：分配栈帧空间</h4><pre class="line-numbers language-assembly"><code class="language-assembly">  400f43:    48 83 ec 18              sub    $0x18,%rsp
  400f47:    48 8d 4c 24 0c           lea    0xc(%rsp),%rcx
  400f4c:    48 8d 54 24 08           lea    0x8(%rsp),%rdx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="第二块：读入数据"><a href="#第二块：读入数据" class="headerlink" title="第二块：读入数据"></a>第二块：读入数据</h4><pre><code>  400f51:    be cf 25 40 00           mov    $0x4025cf,%esi # 将0x4025cf存入寄存器%esi
  400f56:    b8 00 00 00 00           mov    $0x0,%eax  # 将0存入寄存器%eax
  400f5b:    e8 90 fc ff ff           callq  400bf0 &lt;__isoc99_sscanf@plt&gt; # 调用函数&lt;__isoc99_sscanf@plt&gt; 
  400f60:    83 f8 01                 cmp    $0x1,%eax # 将函数的返回值和1比较
  400f63:    7f 05                    jg     400f6a &lt;phase_3+0x27&gt;  # 如果大于1, 跳过explode_bomb
  400f65:    e8 d0 04 00 00           callq  40143a &lt;explode_bomb&gt;  # 引爆炸弹</code></pre><p>我们来看看Mem[0x4025cf]中存储的是什么内容：</p>
<pre class="line-numbers language-bash"><code class="language-bash">x/s 0x4025cf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们发现这是一个字符串”%d %d”。<br><img src="pic10.png" alt="0x4025cf"><br>根据C语言scanf的知识，可以断定，这次我们输入的内容应该是两个整数。<br>我们继续向下看：</p>
<h4 id="第三块：switch"><a href="#第三块：switch" class="headerlink" title="第三块：switch"></a>第三块：switch</h4><p>先看switch前的部分</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  400f6a:    83 7c 24 08 07           cmpl   $0x7,0x8(%rsp) # 将Mem[%rsp+0x8]与7比较
  400f6f:    77 3c                    ja     400fad <phase_3+0x6a>  # 如果大于7（无符号型），跳到爆炸
  400f71:    8b 44 24 08              mov    0x8(%rsp),%eax # 把Mem[%rsp+0x8]写入寄存器%eax
  400f75:    ff 24 c5 70 24 40 00     jmpq   *0x402470(,%rax,8) # Jump Table<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里我们发现需要输入的第一个数要小于等于7，然后会根据我们输入的数进行switch跳转。<br>Mem[0x402470]存放了Jump Table，我们用 x/8xg 0x402470 来查看Jump Table的内容：</p>
<pre class="line-numbers language-bash"><code class="language-bash">x/8xg 0x402470<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic11.png" alt="Jump Table"><br>然后根据这个，我们可以得到如下的跳转关系：</p>
<blockquote>
<p>0 -&gt; 400f7c<br>1 -&gt; 400fb9<br>2 -&gt; 400f83<br>3 -&gt; 400f8a<br>4 -&gt; 400f91<br>5 -&gt; 400f98<br>6 -&gt; 400f9f<br>7 -&gt; 400fa6</p>
</blockquote>
<p>我们来看跳转后的指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  # 0
  400f7c:    b8 cf 00 00 00           mov    $0xcf,%eax
  400f81:    eb 3b                    jmp    400fbe <phase_3+0x7b>
  # 2
  400f83:    b8 c3 02 00 00           mov    $0x2c3,%eax
  400f88:    eb 34                    jmp    400fbe <phase_3+0x7b>
  # 3
  400f8a:    b8 00 01 00 00           mov    $0x100,%eax
  400f8f:    eb 2d                    jmp    400fbe <phase_3+0x7b>
  # 4
  400f91:    b8 85 01 00 00           mov    $0x185,%eax
  400f96:    eb 26                    jmp    400fbe <phase_3+0x7b>
  # 5
  400f98:    b8 ce 00 00 00           mov    $0xce,%eax
  400f9d:    eb 1f                    jmp    400fbe <phase_3+0x7b>
  # 6
  400f9f:    b8 aa 02 00 00           mov    $0x2aa,%eax
  400fa4:    eb 18                    jmp    400fbe <phase_3+0x7b>
  # 7
  400fa6:    b8 47 01 00 00           mov    $0x147,%eax
  400fab:    eb 11                    jmp    400fbe <phase_3+0x7b>

  # .400fad
  400fad:    e8 88 04 00 00           callq  40143a <explode_bomb>
  400fb2:    b8 00 00 00 00           mov    $0x0,%eax
  # 1
  400fb7:    eb 05                    jmp    400fbe <phase_3+0x7b>
  400fb9:    b8 37 01 00 00           mov    $0x137,%eax

  # .400fbe
  400fbe:    3b 44 24 0c              cmp    0xc(%rsp),%eax
  400fc2:    74 05                    je     400fc9 <phase_3+0x86>
  400fc4:    e8 71 04 00 00           callq  40143a <explode_bomb>
  400fc9:    48 83 c4 18              add    $0x18,%rsp
  400fcd:    c3                       retq   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>每条case分支都是将一个数写入寄存器%rax，然后把我们输入的第二个数和它比较是否相等。如果相等，这个阶段解决。</p>
<h3 id="所以本阶段的答案-任选一个"><a href="#所以本阶段的答案-任选一个" class="headerlink" title="所以本阶段的答案:(任选一个)"></a>所以本阶段的答案:(任选一个)</h3><blockquote>
<p>0 207<br>1 311<br>2 707<br>3 256<br>4 389<br>5 206<br>6 682<br>7 327</p>
</blockquote>
<h2 id="五、phase-4"><a href="#五、phase-4" class="headerlink" title="五、phase_4"></a>五、phase_4</h2><p>我们来看这一阶段指令</p>
<h3 id="分析指令-1"><a href="#分析指令-1" class="headerlink" title="分析指令"></a>分析指令</h3><h4 id="片段一：调用函数前"><a href="#片段一：调用函数前" class="headerlink" title="片段一：调用函数前"></a>片段一：调用函数前</h4><pre class="line-numbers language-assembly"><code class="language-assembly">  40100c:    48 83 ec 18              sub    $0x18,%rsp
  401010:    48 8d 4c 24 0c           lea    0xc(%rsp),%rcx
  401015:    48 8d 54 24 08           lea    0x8(%rsp),%rdx
  40101a:    be cf 25 40 00           mov    $0x4025cf,%esi
  40101f:    b8 00 00 00 00           mov    $0x0,%eax
  401024:    e8 c7 fb ff ff           callq  400bf0 <__isoc99_sscanf@plt>
  401029:    83 f8 02                 cmp    $0x2,%eax
  40102c:    75 07                    jne    401035 <phase_4+0x29>  # 如果不相等，引爆炸弹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>和前一阶段一样，本阶段也是输入两个数。调用函数 <strong>isoc99_sscanf@plt</strong> 将返回我们输入数的个数。如果不为2，引爆炸弹。<br>继续往下看：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  40102e:    83 7c 24 08 0e           cmpl   $0xe,0x8(%rsp) # 比较Mem[%rsp + 8]和16
  401033:    76 05                    jbe    40103a <phase_4+0x2e> # 如果小于等于16，跳过炸弹
  401035:    e8 00 04 00 00           callq  40143a <explode_bomb>
  40103a:    ba 0e 00 00 00           mov    $0xe,%edx  # %edx = 16
  40103f:    be 00 00 00 00           mov    $0x0,%esi  # %esi = 0
  401044:    8b 7c 24 08              mov    0x8(%rsp),%edi # %edi = Mem[%rsp + 8]
  401048:    e8 81 ff ff ff           callq  400fce <func4> # 调用函数
  40104d:    85 c0                    test   %eax,%eax # 判断返回值
  40104f:    75 07                    jne    401058 <phase_4+0x4c> # 如果返回值不为0，引爆<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>和上一阶段一样，Mem[%rsp + 8]存的时我们输入的第一个数。输入的数小于等于16时，它会调用函数 <strong>func4</strong> 。其中函数的调用参数如下:</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token function">func4</span><span class="token punctuation">(</span>first_num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>并且函数的返回值必须是0。<br>那我们来看看<strong>func4</strong>函数</p>
<h4 id="片段二：函数-func4"><a href="#片段二：函数-func4" class="headerlink" title="片段二：函数 func4"></a>片段二：函数 func4</h4><p>机器指令如下：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">0000000000400fce <func4>:
  400fce:    48 83 ec 08              sub    $0x8,%rsp # allocate stack space
  400fd2:    89 d0                    mov    %edx,%eax # move %edx -> %eax
  400fd4:    29 f0                    sub    %esi,%eax # %eax -= %esi
  400fd6:    89 c1                    mov    %eax,%ecx # 
  400fd8:    c1 e9 1f                 shr    $0x1f,%ecx
  400fdb:    01 c8                    add    %ecx,%eax
  400fdd:    d1 f8                    sar    %eax
  400fdf:    8d 0c 30                 lea    (%rax,%rsi,1),%ecx
  400fe2:    39 f9                    cmp    %edi,%ecx
  400fe4:    7e 0c                    jle    400ff2 <func4+0x24>

  400fe6:    8d 51 ff                 lea    -0x1(%rcx),%edx
  400fe9:    e8 e0 ff ff ff           callq  400fce <func4>
  400fee:    01 c0                    add    %eax,%eax
  400ff0:    eb 15                    jmp    401007 <func4+0x39>

  # .Block1
  400ff2:    b8 00 00 00 00           mov    $0x0,%eax
  400ff7:    39 f9                    cmp    %edi,%ecx
  400ff9:    7d 0c                    jge    401007 <func4+0x39>

  400ffb:    8d 71 01                 lea    0x1(%rcx),%esi
  400ffe:    e8 cb ff ff ff           callq  400fce <func4>
  401003:    8d 44 00 01              lea    0x1(%rax,%rax,1),%eax
  401007:    48 83 c4 08              add    $0x8,%rsp
  40100b:    c3                   func4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>转换成C语言:</p>
<pre class="line-numbers language-C"><code class="language-C">int fun4(int x, int y, int z) {
    int val = z - y;
    int temp = (val >> 31); //if negative
    val = (val + temp) >> 1;
    temp = val + y;
    if(temp - x <= 0) {
        val = 0;
        if(temp - x >= 0) { // x == temp
            return 0;
        }
    }
    z -= 1;
    val += fun4(x, y, z);
    return val;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>根据C语言逻辑，要想</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token function">func4</span><span class="token punctuation">(</span>first_num<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>第一个参数必须为7。因此我们输入的第一个数为7.</p>
<h4 id="片段三：第二个数"><a href="#片段三：第二个数" class="headerlink" title="片段三：第二个数"></a>片段三：第二个数</h4><pre><code>  401051:    83 7c 24 0c 00           cmpl   $0x0,0xc(%rsp)
  401056:    74 05                    je     40105d &lt;phase_4+0x51&gt;
  401058:    e8 dd 03 00 00           callq  40143a &lt;explode_bomb&gt;
  40105d:    48 83 c4 18              add    $0x18,%rsp
  401061:    c3                       retq   </code></pre><p>Mem[%rsp+12]存储的是我们输入的第二个数。只有这个数为0时，才能逃过炸弹。因此答案很明显了。</p>
<h3 id="本阶段答案"><a href="#本阶段答案" class="headerlink" title="本阶段答案"></a>本阶段答案</h3><blockquote>
<p>7 0</p>
</blockquote>
<p><img src="pic12.png" alt="第四阶段"></p>
<h2 id="六、phase-5"><a href="#六、phase-5" class="headerlink" title="六、phase_5"></a>六、phase_5</h2><h3 id="分析指令-2"><a href="#分析指令-2" class="headerlink" title="分析指令"></a>分析指令</h3><h4 id="片段一：读取输入"><a href="#片段一：读取输入" class="headerlink" title="片段一：读取输入"></a>片段一：读取输入</h4><pre class="line-numbers language-assembly"><code class="language-assembly">  401062:    53                       push   %rbx
  401063:    48 83 ec 20              sub    $0x20,%rsp
  401067:    48 89 fb                 mov    %rdi,%rbx # 将输入的字符串(首地址)保存在%rbx
  40106a:    64 48 8b 04 25 28 00     mov    %fs:0x28,%rax
  401071:    00 00 
  401073:    48 89 44 24 18           mov    %rax,0x18(%rsp)
  401078:    31 c0                    xor    %eax,%eax
  40107a:    e8 9c 02 00 00           callq  40131b <string_length>
  40107f:    83 f8 06                 cmp    $0x6,%eax
  401082:    74 4e                    je     4010d2 <phase_5+0x70>
  401084:    e8 b1 03 00 00           callq  40143a <explode_bomb><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到这部分先计算输入字符串的长度，如果长度不为6，就引爆炸弹。<br>那么是哪六个字符呢？我们继续看。</p>
<h4 id="片段二：循环-1"><a href="#片段二：循环-1" class="headerlink" title="片段二：循环"></a>片段二：循环</h4><p>刚才跳转到4010d2，我们来看这段指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  4010d2:    b8 00 00 00 00           mov    $0x0,%eax  # %eax = 0
  4010d7:    eb b2                    jmp    40108b <phase_5+0x29><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>继续跳转40108b：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  40108b:    0f b6 0c 03              movzbl (%rbx,%rax,1),%ecx # %ecx = Mem[%rbx + %rax]
  40108f:    88 0c 24                 mov    %cl,(%rsp) # Mem[%rsp] = %cl(寄存器%ecx低位的1字节)
  401092:    48 8b 14 24              mov    (%rsp),%rdx # %rdx = %cl
  401096:    83 e2 0f                 and    $0xf,%edx  # %rdx &= 0xf 只保留低位四字节
  401099:    0f b6 92 b0 24 40 00     movzbl 0x4024b0(%rdx),%edx  # %edx = Mem[0x4024b0 + %rdx]
  4010a0:    88 54 04 10              mov    %dl,0x10(%rsp,%rax,1)  # Mem[%rsp + 16 + %rax] = %dl
  4010a4:    48 83 c0 01              add    $0x1,%rax  # %rax += 1
  4010a8:    48 83 f8 06              cmp    $0x6,%rax  # 比较%rax 和 6
  4010ac:    75 dd                    jne    40108b <phase_5+0x29>  # 如果不等于6，继续循环<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看出来，这是一个循环。%eax在循环中会自增，而且我们根据%eax的值来获取字符串中的字符，所以%eax是保存当前字符的下标。<br>我们用x/s 0x4024b0 来看看这里存的是什么：<br><img src="pic13.png" alt="0x4024b0"><br>这段字符串为：”maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?”<br>对%edx使用了位屏蔽，只保留第四位的值，所以%edx的范围是[0,15]，<br>所以上面的字符串有效的部分为“aduiersnfotvbyl”。这个字符串相当与字典，它会根据%edx的大小从其中选取对应下标的字符存储在Mem[%rsp + 16 + %rax]中。<br>我们把循环改成C语言：</p>
<pre class="line-numbers language-c"><code class="language-c">    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> dictionary<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"maduiersnfotvbyl"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">explode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> c<span class="token punctuation">;</span>
    <span class="token keyword">char</span> res_str<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        c <span class="token operator">=</span> s<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        res_str<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> dictionary<span class="token punctuation">[</span>c <span class="token operator">&amp;</span> <span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>继续往下看：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  4010ae:    c6 44 24 16 00           movb   $0x0,0x16(%rsp)
  4010b3:    be 5e 24 40 00           mov    $0x40245e,%esi
  4010b8:    48 8d 7c 24 10           lea    0x10(%rsp),%rdi
  4010bd:    e8 76 02 00 00           callq  401338 <strings_not_equal>
  4010c2:    85 c0                    test   %eax,%eax
  4010c4:    74 13                    je     4010d9 <phase_5+0x77>
  4010c6:    e8 6f 03 00 00           callq  40143a <explode_bomb>
  4010cb:    0f 1f 44 00 00           nopl   0x0(%rax,%rax,1)
  4010d0:    eb 07                    jmp    4010d9 <phase_5+0x77><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第一条指令给新生成字符数组的末尾加上了’\0’，使它成为了字符串。<br>然后比较0x40245e和当前字符串。<br>通过指令 x/s 0x40245e 我们看到字符串为”flyers”。</p>
<blockquote>
<p>要构造这个字符串，我们需要的字典下标为:<br>9 15 14 5 6 7<br>对应的二进制为:<br>1001 1111 1110 0101 0110 0111</p>
</blockquote>
<p>我们输入的字符串ASCII码二进制形式的低位需要是这些数。<br>因此我们可以得到答案：</p>
<h3 id="其中一个答案"><a href="#其中一个答案" class="headerlink" title="其中一个答案"></a>其中一个答案</h3><blockquote>
<p>IONEFG</p>
</blockquote>
<p><img src="pic14.png" alt="第五阶段"></p>
<h2 id="七、phase-6"><a href="#七、phase-6" class="headerlink" title="七、phase_6"></a>七、phase_6</h2><h3 id="分析指令-3"><a href="#分析指令-3" class="headerlink" title="分析指令"></a>分析指令</h3><h4 id="片段一：读取6个数"><a href="#片段一：读取6个数" class="headerlink" title="片段一：读取6个数"></a>片段一：读取6个数</h4><p>我们来看指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  4010f4:    41 56                    push   %r14
  4010f6:    41 55                    push   %r13
  4010f8:    41 54                    push   %r12
  4010fa:    55                       push   %rbp
  4010fb:    53                       push   %rbx
  4010fc:    48 83 ec 50              sub    $0x50,%rsp
  401100:    49 89 e5                 mov    %rsp,%r13
  401103:    48 89 e6                 mov    %rsp,%rsi
  401106:    e8 51 03 00 00           callq  40145c <read_six_numbers>  # 调用函数<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从这我们可以看出，我们输入的应该是6个数。将%rsp的内容写入%rsi，作为函数的调用参数。所以我们输入的6个数将会存放在栈帧中。<br>为了验证这个，我们使用GDB调试。输入6个数：11 22 33 44 55 66<br>使用命令： </p>
<pre class="line-numbers language-bash"><code class="language-bash">x/6dw <span class="token variable">$rsp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic15.png" alt="栈帧"><br>可以看到，Mem[%rsp]及之后连续的地址内存放了我们输入的六个数，猜想正确。</p>
<h4 id="片段二：循环判断"><a href="#片段二：循环判断" class="headerlink" title="片段二：循环判断"></a>片段二：循环判断</h4><p>我们来看指令：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  40110b:    49 89 e6                 mov    %rsp,%r14  # 将数组的首地址存储在%r14
  40110e:    41 bc 00 00 00 00        mov    $0x0,%r12d # %r12d = 0

  # .401114
  401114:    4c 89 ed                 mov    %r13,%rbp  # %rbp = %r13 = %rsp
  401117:    41 8b 45 00              mov    0x0(%r13),%eax # %eax = Mem[%r13 + 0]
  40111b:    83 e8 01                 sub    $0x1,%eax  # %eax -= 1;
  40111e:    83 f8 05                 cmp    $0x5,%eax  # 比较5和%eax
  401121:    76 05                    jbe    401128 <phase_6+0x34>  # 如果小于等于5，跳过引爆炸弹
  401123:    e8 12 03 00 00           callq  40143a <explode_bomb>
  401128:    41 83 c4 01              add    $0x1,%r12d # %r12d += 1
  40112c:    41 83 fc 06              cmp    $0x6,%r12d # %12d :6
  401130:    74 21                    je     401153 <phase_6+0x5f>  # 如果等于6，跳转
  401132:    44 89 e3                 mov    %r12d,%ebx # %ebx = %r12d

  401135:    48 63 c3                 movslq %ebx,%rax  # %eax = %ebx
  401138:    8b 04 84                 mov    (%rsp,%rax,4),%eax # %eax = Mem[%rsp + 4 * %rax]
  40113b:    39 45 00                 cmp    %eax,0x0(%rbp) # %eax:Mem[%rbp]
  40113e:    75 05                    jne    401145 <phase_6+0x51> # 如果不相等，跳过炸弹
  401140:    e8 f5 02 00 00           callq  40143a <explode_bomb>  
  401145:    83 c3 01                 add    $0x1,%ebx  # %ebx += 1
  401148:    83 fb 05                 cmp    $0x5,%ebx  # %rbx : 5
  40114b:    7e e8                    jle    401135 <phase_6+0x41>  # 如果小于等于5
  40114d:    49 83 c5 04              add    $0x4,%r13  # %r13 += 4
  401151:    eb c1                    jmp    401114 <phase_6+0x20>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将其转换成C语言(伪代码，有些缺失)：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">int nums[6];
    int rsi, edx;

    read_six_numbers(nums);
    //All the number ranges in [1, 6] (Incomplete code)
    if(nums[0] - 1 >= 5) {
        explode();
    }
    int index = 0; //%r12
    while(index != 6) {
        index++;
        if(index == 6) 
            break;
        int temp = index;   //%ebx

        Loop1:
            int val = nums[index];     //eax
            if(val == 0)
            explode();
            temp++;
            if(temp <= 5)
                goto Loop1;

        //
    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以发现，所有的数都要在[1,6]范围内，并且互不相同。</p>
<h4 id="片段三：循环操作"><a href="#片段三：循环操作" class="headerlink" title="片段三：循环操作"></a>片段三：循环操作</h4><pre class="line-numbers language-assembly"><code class="language-assembly">  # .501153
  401153:    48 8d 74 24 18           lea    0x18(%rsp),%rsi # %rsi = nums[6] addr, end of the array
  401158:    4c 89 f0                 mov    %r14,%rax # mov the 1st num addr in rax
  40115b:    b9 07 00 00 00           mov    $0x7,%ecx # ecx = 7

  # .401160
  401160:    89 ca                    mov    %ecx,%edx # edx = ecx
  401162:    2b 10                    sub    (%rax),%edx # edx -= (%rax)
  401164:    89 10                    mov    %edx,(%rax) # (%rax) = edx
  401166:    48 83 c0 04              add    $0x4,%rax # %rax += 4 -> next num
  40116a:    48 39 f0                 cmp    %rsi,%rax 
  40116d:    75 f1                    jne    401160 <phase_6+0x6c>
  40116f:    be 00 00 00 00           mov    $0x0,%esi
  401174:    eb 21                    jmp    401197 <phase_6+0xa3><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>转换成C语言：</p>
<pre class="line-numbers language-C"><code class="language-C">for(int i = 0; i < 6; ++i) {
        nums[i] = 7 - nums[i];
    }
    rsi = 0;
    goto L401197;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看出，之一阶段把每个数变成 7-原数</p>
<h4 id="片段四：发现链表"><a href="#片段四：发现链表" class="headerlink" title="片段四：发现链表"></a>片段四：发现链表</h4><p>接着，指令跳转到401197</p>
<pre><code>  # .401197
  401197:    8b 0c 34                 mov    (%rsp,%rsi,1),%ecx # %ecx = num[?]
  40119a:    83 f9 01                 cmp    $0x1,%ecx 
  40119d:    7e e4                    jle    401183 &lt;phase_6+0x8f&gt; # $ecx &lt;= 1, jump
  40119f:    b8 01 00 00 00           mov    $0x1,%eax
  4011a4:    ba d0 32 60 00           mov    $0x6032d0,%edx
  4011a9:    eb cb                    jmp    401176 &lt;phase_6+0x82&gt;</code></pre><p>我们来看看0x6032d0存储的内容：<br>我们使用指令：(一开始可以先用x/d 0x6032d0，发现它是node，然后我们多取几位地址)</p>
<pre class="line-numbers language-bash"><code class="language-bash">x/12xg 0x6032d0
得到如下结果：<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash">0x6032d0 <span class="token operator">&lt;</span>node1<span class="token operator">></span>:    0x000000010000014c    0x00000000006032e0
0x6032e0 <span class="token operator">&lt;</span>node2<span class="token operator">></span>:    0x00000002000000a8    0x00000000006032f0
0x6032f0 <span class="token operator">&lt;</span>node3<span class="token operator">></span>:    0x000000030000039c    0x0000000000603300
0x603300 <span class="token operator">&lt;</span>node4<span class="token operator">></span>:    0x00000004000002b3    0x0000000000603310
0x603310 <span class="token operator">&lt;</span>node5<span class="token operator">></span>:    0x00000005000001dd    0x0000000000603320
0x603320 <span class="token operator">&lt;</span>node6<span class="token operator">></span>:    0x00000006000001bb    0x0000000000000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们发现这是6个结点构成的空间，他们组成了一个链表:</p>
<pre class="line-numbers language-C"><code class="language-C">struct node {
  long x;
  node* next;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>链表的前半部分存储的是数据，后半部分存储的是下一个结点的地址。<br>继续往下看：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  # .401176
  401176:    48 8b 52 08              mov    0x8(%rdx),%rdx
  40117a:    83 c0 01                 add    $0x1,%eax
  40117d:    39 c8                    cmp    %ecx,%eax
  40117f:    75 f5                    jne    401176 <phase_6+0x82>
  401181:    eb 05                    jmp    401188 <phase_6+0x94>

  # .401183
  401183:    ba d0 32 60 00           mov    $0x6032d0,%edx 

  # .401188
  401188:    48 89 54 74 20           mov    %rdx,0x20(%rsp,%rsi,2)
  40118d:    48 83 c6 04              add    $0x4,%rsi
  401191:    48 83 fe 18              cmp    $0x18,%rsi
  401195:    74 14                    je     4011ab <phase_6+0xb7><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将其转换成C语言(goto形式):</p>
<pre class="line-numbers language-c"><code class="language-c">    L401176<span class="token punctuation">:</span>
        rdx <span class="token operator">=</span> Mem<span class="token punctuation">[</span>rdx <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        eax <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>eax <span class="token operator">!=</span> ecx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">goto</span> L401176<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">goto</span> L401188<span class="token punctuation">;</span>

    L401183<span class="token punctuation">:</span>
        edx <span class="token operator">=</span> <span class="token number">0x6032d0</span><span class="token punctuation">;</span>

    L401188<span class="token punctuation">:</span>
        Mem<span class="token punctuation">[</span>rsp <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> rsi <span class="token operator">+</span> <span class="token number">0x20</span><span class="token punctuation">]</span> <span class="token operator">=</span> rdx<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//Save Node addr in the end of array</span>
        rsi <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rsi <span class="token operator">==</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">goto</span> L4011ab<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    L401197<span class="token punctuation">:</span>
        ecx <span class="token operator">=</span> nums<span class="token punctuation">[</span>rsi <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ecx <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 7-nums[i] &lt;= 1</span>
            <span class="token keyword">goto</span> L401183<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        eax <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        edx <span class="token operator">=</span> <span class="token number">0x6032d0</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> L401176<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这段代码的意思如下：<br>将链表的每个结点从1~6编号，变化后nums[]数组中的值与结点形成映射关系。<br>将nums[]数组对应的结点地址依次存放到栈帧空间。</p>
<h4 id="片段五：构成新链表"><a href="#片段五：构成新链表" class="headerlink" title="片段五：构成新链表"></a>片段五：构成新链表</h4><pre class="line-numbers language-assembly"><code class="language-assembly">  # .4011ab
  4011ab:    48 8b 5c 24 20           mov    0x20(%rsp),%rbx
  4011b0:    48 8d 44 24 28           lea    0x28(%rsp),%rax
  4011b5:    48 8d 74 24 50           lea    0x50(%rsp),%rsi
  4011ba:    48 89 d9                 mov    %rbx,%rcx

  # .4011bd
  4011bd:    48 8b 10                 mov    (%rax),%rdx
  4011c0:    48 89 51 08              mov    %rdx,0x8(%rcx)
  4011c4:    48 83 c0 08              add    $0x8,%rax
  4011c8:    48 39 f0                 cmp    %rsi,%rax
  4011cb:    74 05                    je     4011d2 <phase_6+0xde>
  4011cd:    48 89 d1                 mov    %rdx,%rcx
  4011d0:    eb eb                    jmp    4011bd <phase_6+0xc9>

  # .4011d2  4011e3:    8b 00                    mov    (%rax),%eax # long->int
  4011e5:    39 03                    cmp    %eax,(%rbx)
  4011d2:    48 c7 42 08 00 00 00     movq   $0x0,0x8(%rdx)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将其转换成C语言：</p>
<pre class="line-numbers language-c"><code class="language-c">    L4011ab<span class="token punctuation">:</span>
        rbx <span class="token operator">=</span> Mem<span class="token punctuation">[</span>rsp <span class="token operator">+</span> <span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// the first node</span>
        rax <span class="token operator">=</span> rsp <span class="token operator">+</span> <span class="token number">0x28</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// the second node addr</span>
        rsi <span class="token operator">=</span> rsp <span class="token operator">+</span> <span class="token number">0x50</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// end of the array</span>
        rcx <span class="token operator">=</span> rbx<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//Change this node next pointer, make them a new linklist</span>
    L4011bd<span class="token punctuation">:</span>
        rdx <span class="token operator">=</span> Mem<span class="token punctuation">[</span>rax<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// the second node</span>
        Mem<span class="token punctuation">[</span>rcx <span class="token operator">+</span> <span class="token number">0x8</span><span class="token punctuation">]</span> <span class="token operator">=</span> rdx<span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//the node next pointer</span>
        rax <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//the next node in array</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rax <span class="token operator">==</span> rsi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">goto</span> L4011d2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">goto</span> L4011bd<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//set the endNode->next to NULL</span>
    L4011d2<span class="token punctuation">:</span>
        Mem<span class="token punctuation">[</span>rdx <span class="token operator">+</span> <span class="token number">0x8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这段代码将结点按新的顺序重新连接成新的链表。</p>
<h4 id="片段六：比较链表中结点的数据域"><a href="#片段六：比较链表中结点的数据域" class="headerlink" title="片段六：比较链表中结点的数据域"></a>片段六：比较链表中结点的数据域</h4><pre class="line-numbers language-assembly"><code class="language-assembly">  4011da:    bd 05 00 00 00           mov    $0x5,%ebp

  # .4011df
  4011df:    48 8b 43 08              mov    0x8(%rbx),%rax
  4011e3:    8b 00                    mov    (%rax),%eax # long->int
  4011e5:    39 03                    cmp    %eax,(%rbx)
  4011e7:    7d 05                    jge    4011ee <phase_6+0xfa>
  4011e9:    e8 4c 02 00 00           callq  40143a <explode_bomb>

  4011ee:    48 8b 5b 08              mov    0x8(%rbx),%rbx
  4011f2:    83 ed 01                 sub    $0x1,%ebp
  4011f5:    75 e8                    jne    4011df <phase_6+0xeb> # ebp != 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>转换成C语言</p>
<pre class="line-numbers language-c"><code class="language-c">    <span class="token comment" spellcheck="true">//The new linklist should in descending order</span>
    L4011df<span class="token punctuation">:</span>
        rax <span class="token operator">=</span> Mem<span class="token punctuation">[</span>rbx <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// now node->data</span>
        eax <span class="token operator">=</span> Mem<span class="token punctuation">[</span>rax<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//next node->data</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rbx <span class="token operator">&lt;</span> eax<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//unsigned</span>
            <span class="token function">explode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        rbx <span class="token operator">=</span> Mem<span class="token punctuation">[</span>rbx <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        ebp <span class="token operator">-</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ebp <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">goto</span> L4011df<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    OK<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从这段代码可以看出：它比较链表中的每个值，链表为降序才能通过，否则引爆。<br>注意这里</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  4011e3:    8b 00                    mov    (%rax),%eax # long->int
  4011e5:    39 03                    cmp    %eax,(%rbx)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>它将数据转换成32位整形比较！<br>这样这个阶段就可以解决了！</p>
<h3 id="解决答案"><a href="#解决答案" class="headerlink" title="解决答案"></a>解决答案</h3><p>1.首先我们输入的这六个数在[1,6]范围内。<br>2.这六个数在程序中转换成了 7 - nums[i]。<br>3.变换后的六个数，所对应的结点的值应该按递减的顺序。<br>各个结点的值：（已转换成int）</p>
<pre class="line-numbers language-bash"><code class="language-bash">0x6032d0 <span class="token operator">&lt;</span>node1<span class="token operator">></span>:    0x0000014c    0x00000000006032e0
0x6032e0 <span class="token operator">&lt;</span>node2<span class="token operator">></span>:    0x000000a8    0x00000000006032f0
0x6032f0 <span class="token operator">&lt;</span>node3<span class="token operator">></span>:    0x0000039c    0x0000000000603300
0x603300 <span class="token operator">&lt;</span>node4<span class="token operator">></span>:    0x000002b3    0x0000000000603310
0x603310 <span class="token operator">&lt;</span>node5<span class="token operator">></span>:    0x000001dd    0x0000000000603320
0x603320 <span class="token operator">&lt;</span>node6<span class="token operator">></span>:    0x000001bb    0x0000000000000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>将结点从大到小排序：3 4 5 6 1 2<br>那么7-nums[i]依次为：3 4 5 6 1 2<br>则nums[i]依次为：4 3 2 1 6 5</p>
</blockquote>
<blockquote>
<p>所以最终答案为：4 3 2 1 6 5</p>
</blockquote>
<p><img src="pic16.png" alt="解决"></p>
<h2 id="八、彩蛋题"><a href="#八、彩蛋题" class="headerlink" title="八、彩蛋题"></a>八、彩蛋题</h2><h3 id="进入彩蛋"><a href="#进入彩蛋" class="headerlink" title="进入彩蛋"></a>进入彩蛋</h3><p>汇编代码中 <em>phase_6</em> 后的 <em>fun7</em> 似乎没有用到，再看看汇编代码，它被 <em>secret_phase</em> 这个函数调用。<br>我们来看看哪里调用了 <em>secret_phase</em> 。<br>在 <em>phase_defused</em> 这部分中发现了调用。</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">00000000004015c4 <phase_defused>:
  4015c4:    48 83 ec 78              sub    $0x78,%rsp
  4015c8:    64 48 8b 04 25 28 00     mov    %fs:0x28,%rax
  4015cf:    00 00 
  4015d1:    48 89 44 24 68           mov    %rax,0x68(%rsp)
  4015d6:    31 c0                    xor    %eax,%eax
  4015d8:    83 3d 81 21 20 00 06     cmpl   $0x6,0x202181(%rip)        # 603760 <num_input_strings>
  4015df:    75 5e                    jne    40163f <phase_defused+0x7b><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>只有在0x202181(%rip)等于6的时候，才不会跳转。也就是说，只有当读取了6个字符串时，才会触发这个阶段。<br>继续往下看：</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  4015e1:    4c 8d 44 24 10           lea    0x10(%rsp),%r8
  4015e6:    48 8d 4c 24 0c           lea    0xc(%rsp),%rcx
  4015eb:    48 8d 54 24 08           lea    0x8(%rsp),%rdx
  4015f0:    be 19 26 40 00           mov    $0x402619,%esi
  4015f5:    bf 70 38 60 00           mov    $0x603870,%edi
  4015fa:    e8 f1 f5 ff ff           callq  400bf0 <__isoc99_sscanf@plt><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们在phase_6设置断点，查看内存地址0x402619，为：</p>
<blockquote>
<p>“%d %d %s”</p>
</blockquote>
<p>说明要读取的是两个数和一个字符串<br>我们继续查看0x603870，得到”7 0”。这正好是我们在第四阶段输入的答案。而且这一阶段的输入正好对应了前面的”%d %d”。<br>因此可以猜测，彩蛋题的答案应追加在第四阶段的答案上。</p>
<pre class="line-numbers language-assembly"><code class="language-assembly">  4015ff:    83 f8 03                 cmp    $0x3,%eax
  401602:    75 31                    jne    401635 <phase_defused+0x71>
  401604:    be 22 26 40 00           mov    $0x402622,%esi
  401609:    48 8d 7c 24 10           lea    0x10(%rsp),%rdi
  40160e:    e8 25 fd ff ff           callq  401338 <strings_not_equal>
  401613:    85 c0                    test   %eax,%eax
  401615:    75 1e                    jne    401635 <phase_defused+0x71>
  401617:    bf f8 24 40 00           mov    $0x4024f8,%edi
  40161c:    e8 ef f4 ff ff           callq  400b10 <puts@plt>
  401621:    bf 20 25 40 00           mov    $0x402520,%edi
  401626:    e8 e5 f4 ff ff           callq  400b10 <puts@plt>
  40162b:    b8 00 00 00 00           mov    $0x0,%eax
  401630:    e8 0d fc ff ff           callq  401242 <secret_phase><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先判断我们输入的是不是对应3个内容。然后将0x402622移入%esi，并与我们输入的字符串进行比较。<br>通过命令 </p>
<pre class="line-numbers language-bash"><code class="language-bash">x/s 0x402622<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们可以看到内容为：</p>
<blockquote>
<p>“DrEvil”</p>
</blockquote>
<p>所以我们应该在7 0后面追加 DrEvil。<br><img src="pic17.png" alt="进入彩蛋"></p>
<h3 id="分析secret-phase"><a href="#分析secret-phase" class="headerlink" title="分析secret_phase"></a>分析secret_phase</h3><pre class="line-numbers language-assembly"><code class="language-assembly">0000000000401242 <secret_phase>:
  401242:    53                       push   %rbx
  401243:    e8 56 02 00 00           callq  40149e <read_line>
  401248:    ba 0a 00 00 00           mov    $0xa,%edx
  40124d:    be 00 00 00 00           mov    $0x0,%esi
  401252:    48 89 c7                 mov    %rax,%rdi
  401255:    e8 76 f9 ff ff           callq  400bd0 <strtol@plt>
  40125a:    48 89 c3                 mov    %rax,%rbx
  40125d:    8d 40 ff                 lea    -0x1(%rax),%eax
  401260:    3d e8 03 00 00           cmp    $0x3e8,%eax
  401265:    76 05                    jbe    40126c <secret_phase+0x2a>
  401267:    e8 ce 01 00 00           callq  40143a <explode_bomb>
  40126c:    89 de                    mov    %ebx,%esi
  40126e:    bf f0 30 60 00           mov    $0x6030f0,%edi
  401273:    e8 8c ff ff ff           callq  401204 <fun7>
  401278:    83 f8 02                 cmp    $0x2,%eax
  40127b:    74 05                    je     401282 <secret_phase+0x40>
  40127d:    e8 b8 01 00 00           callq  40143a <explode_bomb>
  401282:    bf 38 24 40 00           mov    $0x402438,%edi
  401287:    e8 84 f8 ff ff           callq  400b10 <puts@plt>
  40128c:    e8 33 03 00 00           callq  4015c4 <phase_defused><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先调用 <em>read_line</em> 读取一行输入，然后用所得的字符串调用 <em>strtol@plt</em> ，得到字符串对应的长整型。将长整型结果复制到%rbx中，令%eax = %rax-1。如果%eax &lt;= 0x3e8（1000）,跳过炸弹。所以字符串转换后的数应该小于1001.</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token function">strtol</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>跳过炸弹后，调用函数fun7(0x6030f0, %esi),%esi存储的是字符串对应的整形。<br><em>fun7</em> 返回值需要为2，否则引爆炸弹<br>那我们来看fun7</p>
<h3 id="分析fun7"><a href="#分析fun7" class="headerlink" title="分析fun7"></a>分析fun7</h3><p>我们先来看看之前出现的0x6030f0内存空间<br>x/x 0x6030f0<br><img src="pic18.png" alt="0x6030f0-1"><br>可以发现里边有一个整数，但这个是一个结构体，显示的内容还不完整，我们继续查看。</p>
<pre class="line-numbers language-bash"><code class="language-bash">x/100x 0x6030f0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="pic19.png" alt="0x6030f0-2"><br>我们发现这个结构体的第一块区域存了数据，后面两块存储的是地址，最后一块都为0。这和我们学过的二叉树很像！那猜想第一段地址为左孩子，第二段地址为右孩子，那么我们可以把这棵树构建出来。<br><img src="pic21.png" alt="二叉树"></p>
<pre class="line-numbers language-assembly"><code class="language-assembly">0000000000401204 <fun7>:
  401204:    48 83 ec 08              sub    $0x8,%rsp
  401208:    48 85 ff                 test   %rdi,%rdi
  40120b:    74 2b                    je     401238 <fun7+0x34>
  40120d:    8b 17                    mov    (%rdi),%edx
  40120f:    39 f2                    cmp    %esi,%edx
  401211:    7e 0d                    jle    401220 <fun7+0x1c>
  401213:    48 8b 7f 08              mov    0x8(%rdi),%rdi
  401217:    e8 e8 ff ff ff           callq  401204 <fun7>
  40121c:    01 c0                    add    %eax,%eax
  40121e:    eb 1d                    jmp    40123d <fun7+0x39>
  401220:    b8 00 00 00 00           mov    $0x0,%eax
  401225:    39 f2                    cmp    %esi,%edx
  401227:    74 14                    je     40123d <fun7+0x39>
  401229:    48 8b 7f 10              mov    0x10(%rdi),%rdi
  40122d:    e8 d2 ff ff ff           callq  401204 <fun7>
  401232:    8d 44 00 01              lea    0x1(%rax,%rax,1),%eax
  401236:    eb 05                    jmp    40123d <fun7+0x39>

  401238:    b8 ff ff ff ff           mov    $0xffffffff,%eax
  40123d:    48 83 c4 08              add    $0x8,%rsp
  401241:    c3                       retq   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>改写成C语言:</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">fun7</span><span class="token punctuation">(</span>TNode<span class="token operator">*</span> root<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//edx</span>
    <span class="token keyword">int</span> ret_val<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0xffffffff</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    val <span class="token operator">=</span> root<span class="token operator">-></span>data<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">&lt;=</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">goto</span> L401220<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ret_val <span class="token operator">=</span> <span class="token function">fun7</span><span class="token punctuation">(</span>TNode<span class="token operator">-></span>left<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> ret_val<span class="token punctuation">;</span>

    L401220<span class="token punctuation">:</span>
        ret_val <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">==</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ret_val <span class="token operator">=</span> <span class="token function">fun7</span><span class="token punctuation">(</span>TNode<span class="token operator">-></span>right<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret_val <span class="token operator">=</span> ret_val <span class="token operator">+</span> ret_val <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret_val<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用非goto:</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">fun7</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> 
        <span class="token keyword">return</span> <span class="token number">0xffffffff</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>root<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>root<span class="token operator">-></span>data <span class="token operator">&lt;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">fun7</span><span class="token punctuation">(</span>root<span class="token operator">-></span>right<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">fun7</span><span class="token punctuation">(</span>TNode<span class="token operator">-></span>left<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看出，如果当前结点和传入的值相等，返回0；<br>如果大于传入的结点，访问左子树；<br>小于传入的值，访问右子树。<br>要使最终的返回值为2，应该这样走：root -&gt; left -&gt; right<br>此时的结点值为0x16(22)</p>
<h3 id="答案-1"><a href="#答案-1" class="headerlink" title="答案"></a>答案</h3><blockquote>
<p>22</p>
</blockquote>
<p><img src="pic20.png" alt="完成"></p>
<h2 id="实验小结"><a href="#实验小结" class="headerlink" title="实验小结"></a>实验小结</h2><p>通过Bomb Lab实验，我学会了使用gdb调试工具，而且对机器指令有了更深的理解。通过GDB调试工具的使用，我也进一步理解了栈帧空间的框架，和原理。对函数调用，参数传递有了进一步的认识！</p>
<p>Total Time: 14h</p>

            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《CSAPP实验：Bomb Lab》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2021/01/08/bomb-lab/" property="cc:attributionName"
               rel="cc:attributionURL">
                Evan Lynn
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '57b37f2c8d1ae57437fa',
        clientSecret: 'f4c9937f9f3d250b4bce0ec31794503723bcbfb9',
        repo: 'evanlynnn.github.io',
        owner: 'evanlynnn',
        admin: "evanlynnn",
        id: '2021/01/08/bomb-lab/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-dot-circle-o"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2021/01/08/bomb-lab/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="CSAPP实验：Bomb Lab">
                        
                        <span class="card-title">CSAPP实验：Bomb Lab</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本实验文件基于CMU 15-213课程实验Bomb Lab。希望我的实验过程详解可以给你带来启发。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-01-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CS实验/" class="post-category" target="_blank">
                                    CS实验
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/组成原理/" target="_blank">
                        <span class="chip bg-color">组成原理</span>
                    </a>
                    
                    <a href="/tags/CSAPP/" target="_blank">
                        <span class="chip bg-color">CSAPP</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/12/31/kmp/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="字符串的模式匹配KMP">
                        
                        <span class="card-title">字符串的模式匹配KMP</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文介绍的了字符串匹配算法KMP的原理。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2020-12-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/数据结构复习/" class="post-category" target="_blank">
                                    数据结构复习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/算法/" target="_blank">
                        <span class="chip bg-color">算法</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Evan Lynn's Blog<br />'
            + '作者: Evan Lynn<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2021-2021 Evan Lynn. 版权所有| 
            <a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备2021000355号-1</a> |


            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">11.5k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/evanlynnn" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>







    <a href="http://wpa.qq.com/msgrd?v=3&uin=762182865&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 0;
        var uvcountOffset = 0;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2020, 12, 27, 23, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>